# ============================================================================
# SyncFlow Dashboard Configuration
# ============================================================================
# Copy to .env.local and edit as needed. Defaults are provided for local dev.
# ⚠️ Never commit this file or include API keys in version control.
#

# ============================================================================
# Server & Network
# ============================================================================

# Express server port (default: 5050)
PORT=5050

# MongoDB connection string (default: mongodb://localhost:27017/syncflow-dashboard)
MONGODB_URI=mongodb://localhost:27017/syncflow-dashboard

# Frontend API endpoint (default: empty = same-origin, i.e., http://localhost:5050)
# In production, set to empty string to use same-origin
VITE_API_BASE=http://localhost:5050

# Frontend WebSocket endpoint (default: empty = same-origin)
# In production, set to empty string to use same-origin
VITE_SOCKET_URL=http://localhost:5050

# ============================================================================
# Authentication & Multi-Tenant
# ============================================================================

# Auth mode: "strict" (production) or "dev" (development, default)
# - strict: Validate all agents and dashboard viewers against TENANTS_JSON
# - dev: Allow any app to register with explicit tenantId; optional tokens for dashboard
# ⚠️ Always use "strict" in production multi-tenant deployments
AUTH_MODE=dev

# Optional API key to authenticate dashboard HTTP requests (/api/traces, /api/insights, etc.)
# If set, all requests must include "Authorization: Bearer <DASHBOARD_API_KEY>" header
# Exposed to frontend as VITE_DASHBOARD_API_KEY (see below)
DASHBOARD_API_KEY=

# Exposed to frontend; used for Authorization header in browser requests
# Only set if DASHBOARD_API_KEY is set above
VITE_DASHBOARD_API_KEY=

# ============================================================================
# Multi-Tenant Configuration (Optional, for production)
# ============================================================================

# JSON string defining all tenants, their apps, and dashboard viewers
# Set this to enable multi-tenant strict authentication
# Example (single line):
#   {"acme-corp":{"apps":{"acme-api":"secret-agent-key-1","acme-web":"secret-agent-key-2"},"dashboards":{"viewer-alice":true,"viewer-bob":true}}}
#
# Structure:
#   - Each tenant has "apps": {appName: agentKey} for agent authentication
#   - Each tenant has "dashboards": {viewerToken: true} for UI auth
#   - If AUTH_MODE=strict, agents provide (appName, agentKey) from TENANTS_JSON
#   - If AUTH_MODE=strict, UIs provide X-Tenant-Id header + optional Bearer token
#
# If not set (empty):
#   - HTTP: /api/traces returns [], routes allow requests through but no data available
#   - Sockets: Agent register is rejected, UI join_tenant is rejected (no rooms to join)
#   - Demo: Still works if DEMO_MODE_ENABLED=true (demo is feature-driven, not tenant-driven)
#   - In dev mode (AUTH_MODE=dev): Agents cannot register (need tenant context)
#   - In strict mode: All operations return 401/403 errors (no tenant configuration)
#
# Behavior Summary (TENANTS_JSON empty):
#   ❌ No agents can connect
#   ❌ No socket events accepted or broadcast
#   ❌ No real-time subscriptions (UI cannot join rooms)
#   ✅ HTTP requests allowed through, but /api/traces returns []
#   ✅ Demo mode works independently if DEMO_MODE_ENABLED=true
TENANTS_JSON=

# ============================================================================
# Demo Mode
# ============================================================================

# Enable/disable demo mode toggle in the UI
# Set to "true" to enable demo mode (allows toggling between real and demo data)
# Set to "false" (default) to hide demo mode UI completely
# Demo mode is tenant-scoped and works independently of TENANTS_JSON configuration
# Demo data is always isolated per tenant and marked with source: "demo"
DEMO_MODE_ENABLED=false

# Optional token for demo mode operations (POST/DELETE /api/demo-seed)
# Authentication for demo routes uses X-Demo-Token header (separate from viewer auth)
# - Dev mode (AUTH_MODE=dev): No token required, demo works without this
# - Strict mode (AUTH_MODE=strict): Token required if set; demo disabled if empty
# The frontend must set VITE_DEMO_MODE_TOKEN (below) to match this for strict mode
# Note: Demo routes ALSO require viewer auth (Authorization: Bearer) when TENANTS_JSON exists
DEMO_MODE_TOKEN=

# Frontend demo mode token (must match DEMO_MODE_TOKEN above)
# Sent as X-Demo-Token header for demo operations
# Required in strict mode if DEMO_MODE_TOKEN is set
# Example: VITE_DEMO_MODE_TOKEN=demo-secret-key-123
VITE_DEMO_MODE_TOKEN=

# ============================================================================
# Frontend Tenant Assignment
# ============================================================================

# Tenant ID for this dashboard UI build (REQUIRED)
# Dashboard will operate within this tenant only; cannot be switched at runtime
# This MUST be set explicitly - no default value is provided
# Set this per-build for multi-tenant deployments
# Example: VITE_TENANT_ID=acme-corp, VITE_TENANT_ID=demo, VITE_TENANT_ID=my-tenant
VITE_TENANT_ID=

# ============================================================================
# AI Insights (Optional)
# ============================================================================

# Enable AI-powered insights (default: true)
# Set to "false" to disable OpenAI integration; heuristic fallback still works
ENABLE_AI_INSIGHTS=true

# OpenAI API key (required if ENABLE_AI_INSIGHTS=true)
# Get one from https://platform.openai.com/account/api-keys
# ⚠️ Keep this private; never commit to version control
OPENAI_API_KEY=

# OpenAI model to use for insights (default: gpt-4o-mini)
# Other options: gpt-4, gpt-4-turbo, gpt-3.5-turbo, gpt-4o, etc.
INSIGHT_MODEL=gpt-4o-mini

# Timeout for insight generation in milliseconds (default: 12000 = 12 seconds)
INSIGHT_TIMEOUT_MS=12000

# Number of retries for failed insight requests (default: 2)
INSIGHT_RETRIES=2

# ============================================================================
# AI Sampling & Rate Limiting
# ============================================================================

# Fraction of traces to generate insights for (0-1, default: 1)
# 1 = all traces, 0.5 = 50% of traces, 0 = no insights
# Useful in production to reduce API costs and latency
AI_INSIGHT_SAMPLE_RATE=1

# Only sample traces with errors (true/false, default: false)
# If true: insights only for traces with ERROR level events
# If false: insights for all traces (subject to SAMPLE_RATE)
AI_INSIGHT_SAMPLE_ERRORS_ONLY=false

# Rate limit window in milliseconds (default: 60000 = 1 minute)
AI_RATE_LIMIT_WINDOW_MS=60000

# Max AI requests per rate limit window (default: 20)
# If exceeded, subsequent insight requests return 429 with retryAfterMs
AI_RATE_LIMIT_MAX=20




